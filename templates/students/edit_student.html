{% extends "base.html" %}
{% block content %}
<div class="card" style="max-width:760px;margin:22px auto;">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;">
    <div>
      <h1 class="h1" style="margin-bottom:6px;">Edit Student</h1>
      <p class="muted" style="margin:0;">
        Admin-only. Email & mobile are stored encrypted.
      </p>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <a class="btn btn-secondary" href="{% url 'dashboards:admin_dashboard' %}">‚Üê Back to Admin</a>
      <a class="btn btn-secondary" href="{% url 'audit:audit_logs' %}">Audit Logs</a>
    </div>
  </div>

  <div class="card" style="margin-top:14px;padding:12px 14px;">
    <div style="display:flex;gap:18px;flex-wrap:wrap;">
      <div><span class="muted">Student UID:</span> <strong>{{ student.student_uid }}</strong></div>
      <div><span class="muted">DB ID:</span> <strong>#{{ student.id }}</strong></div>
      <div><span class="muted">Last Active:</span> <strong>{{ student.last_login_at|default:"Never" }}</strong></div>
    </div>
  </div>

  <form method="post" style="margin-top:14px;">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-error">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <div class="grid-2" style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
      <div>
        <label class="form-label">Full Name</label>
        {{ form.full_name }}
        {% if form.full_name.errors %}
          <div class="hint" style="color:#b00020;">{{ form.full_name.errors }}</div>
        {% else %}
          <div class="hint">As per official records</div>
        {% endif %}
      </div>

      <div>
        <label class="form-label">Class</label>
        {{ form.class_grade }}
        {% if form.class_grade.errors %}
          <div class="hint" style="color:#b00020;">{{ form.class_grade.errors }}</div>
        {% else %}
          <div class="hint">Used for dashboard grouping</div>
        {% endif %}
      </div>
    </div>

    <div class="grid-2" style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px;">
      <div>
        <label class="form-label">Email</label>
        {{ form.email }}
        {% if form.email.errors %}
          <div class="hint" style="color:#b00020;">{{ form.email.errors }}</div>
        {% else %}
          <div class="hint">üìß Stored encrypted at rest</div>
        {% endif %}
      </div>

      <div>
        <label class="form-label">Mobile</label>
        {{ form.mobile }}
        {% if form.mobile.errors %}
          <div class="hint" style="color:#b00020;">{{ form.mobile.errors }}</div>
        {% else %}
          <div class="hint">üîí Stored encrypted at rest</div>
        {% endif %}
      </div>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:18px;">
      <button class="btn btn-primary" type="submit" style="height:44px;min-width:160px;">
        Save Changes
      </button>
      <a class="btn btn-secondary" href="{% url 'dashboards:admin_dashboard' %}" style="height:44px;">
        Cancel
      </a>
      <div class="muted" style="margin-left:auto;">
        Tip: changes will appear in Audit Logs
      </div>
    </div>
  </form>
</div>
{% endblock %}
